version: ~> 1.0
language: c++
jobs:
  include:
    - name: Linux (Ubuntu Bionic)
      os: linux
      dist: bionic
      # virt: lxd
    - name: Linux (Ubuntu Xenial)
      os: linux
      dist: xenial
      # virt: lxd
      env: EXTRA_CXXFLAGS="-DARIA_OMIT_DEPRECATED_MATH_FUNCS"
    - name: MacOSX
      os: osx
#    - name: Linux (Ubuntu Bionic on arm64)
#      os: linux
#      virt: lxd
#      arch: arm64
#      dist: bionic
    - name: Windows
      os: windows
      env:
        - MSBUILD_PATH="C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin"
      install:
        - choco install visualstudio2019buildtools --package-parameters "--add Microsoft.VisualStudio.Component.VC.Tools.x86.x64"
      script:
        - export PATH=$MSBUILD_PATH:$PATH
        - MSBuild.exe visualc\AriaCoda.sln -p:Configuration=Debug -p:Platform=x64 -maxCpuCount
git:
  depth: 1
script:
  - make -j4 CXXDEBUGFLAGS= CXXOPTFLAGS=-O0
